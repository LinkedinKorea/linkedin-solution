<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkedIn ê¸°ì—…ìš© ì†”ë£¨ì…˜ ìë™ ê²¬ì ì„œ</title>
  <style>
    :root{--bg:#0b0f14;--card:#111827;--muted:#9ca3af;--text:#e5e7eb;--accent:#60a5fa;--line:#1f2937;--soft:#0b1220}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial; background:linear-gradient(180deg,#070a0f,#0b0f14 40%); color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{max-width:1120px;margin:0 auto;padding:26px 16px 110px}
    .top{display:flex;gap:12px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:-.2px}
    .sub{margin:8px 0 0;color:var(--muted);line-height:1.55;font-size:13px}
    .pill{display:inline-flex;gap:8px;align-items:center;background:rgba(96,165,250,.12);border:1px solid rgba(96,165,250,.25);color:#cfe6ff;padding:8px 10px;border-radius:999px;font-size:12px}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:rgba(17,24,39,.72);border:1px solid var(--line);border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.25);overflow:hidden}
    .hd{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .hd b{font-size:14px}
    .bd{padding:14px 16px}

    label{display:block;font-size:12px;color:#cbd5e1;margin-bottom:6px}
    input, select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:var(--soft);color:var(--text);outline:none;font-family:inherit;font-size:13px}
    input[type="date"]{font-family:inherit;font-size:13px;color:var(--text)}
    input:focus, select:focus{border-color:rgba(96,165,250,.6);box-shadow:0 0 0 3px rgba(96,165,250,.14)}
    input[readonly]{opacity:.92}

    .rows{display:grid;gap:16px}
    .row{display:grid;grid-template-columns:1fr 160px 160px;gap:12px;align-items:end;padding:8px 0}
    @media (max-width:720px){.row{grid-template-columns:1fr}}

    .hint{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.35;min-height:18px}
    .desc{color:var(--muted);font-size:12px;line-height:1.5;margin-top:4px;white-space:pre-line}

    table{width:100%;border-collapse:separate;border-spacing:0}
    th, td{padding:10px 10px;border-bottom:1px solid var(--line);vertical-align:top}
    th{font-size:12px;color:#cbd5e1;text-align:left;background:rgba(11,18,32,.35)}
    td{font-size:13px}
    .right{text-align:right}

    .kpis{display:grid;gap:10px}
    .kpi{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(11,18,32,.55)}
    .kpi .t{font-size:12px;color:var(--muted)}
    .kpi .v{font-size:20px;font-weight:900;margin-top:6px;letter-spacing:-.2px}

    .callout{margin-top:12px;padding:10px 12px;border-radius:14px;border:1px solid rgba(96,165,250,.25);background:rgba(96,165,250,.08);color:#dbeafe;font-size:12px;line-height:1.55}

    .aiBox{border:1px dashed rgba(96,165,250,.35);background:rgba(96,165,250,.06);border-radius:16px;padding:12px;margin-top:6px}

    .sticky{position:fixed;left:0;right:0;bottom:0;padding:14px 14px;background:rgba(8,12,18,.72);backdrop-filter:blur(10px);border-top:1px solid var(--line)}
    .sticky .inner{max-width:1120px;margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;border:1px solid var(--line);background:var(--soft);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;font-size:13px}
    button.primary{border-color:rgba(96,165,250,.45);background:rgba(96,165,250,.14)}
    button:hover{filter:brightness(1.07)}

    .toast{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);background:rgba(17,24,39,.92);border:1px solid var(--line);padding:10px 12px;border-radius:12px;box-shadow:0 12px 24px rgba(0,0,0,.35);font-size:13px;display:none;z-index:9999}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>LinkedIn ê¸°ì—…ìš© ì†”ë£¨ì…˜ ìë™ ê²¬ì ì„œ</h1>
        <div class="sub">
          ê³ ê°ì´ ì§ì ‘ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ <b>USD ê¸°ì¤€ ê²¬ì </b>ì„ ê³„ì‚°í•˜ê³ , ë§¨ í•˜ë‹¨ ë²„íŠ¼ìœ¼ë¡œ <b>ê²¬ì ì„œ(PDF)</b>ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          <br/>â€» í‘œê¸° ê¸ˆì•¡ì€ ë‹¨ê°€ ê¸°ì¤€ì´ë©°, ì‹¤ì œ ê³„ì•½/ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <b>ë§¤ë…„ 7ì›” 1ì¼ë¶€í„° ê¸ˆì•¡ì´ ì¸ìƒë©ë‹ˆë‹¤.</b>
        </div>
      </div>
      <div class="pill">ë¶€ê°€ì„¸ ì—†ìŒ Â· USD ê¸°ì¤€</div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="hd"><b>ê³ ê°/ê²¬ì  ì •ë³´</b><span class="muted">PDFì— í•¨ê»˜ ì¶œë ¥ë©ë‹ˆë‹¤</span></div>
        <div class="bd">
          <div class="rows">
            <div class="row" style="grid-template-columns:1fr 1fr 1fr;align-items:end">
              <div>
                <label for="company">íšŒì‚¬ëª…</label>
                <input id="company" placeholder="ì˜ˆ: ãˆœí™ê¸¸ë™" />
              </div>
              <div>
                <label for="contact">ë‹´ë‹¹ìëª…</label>
                <input id="contact" placeholder="ì˜ˆ: í™ê¸¸ë™" />
              </div>
              <div>
                <label for="email">ì´ë©”ì¼</label>
                <input id="email" placeholder="ì˜ˆ: hr@company.com" />
              </div>
            </div>

            <div class="row" style="grid-template-columns:1fr 1fr 1fr;align-items:end">
              <div>
                <label for="quoteNo">ê²¬ì ë²ˆí˜¸</label>
                <input id="quoteNo" class="mono" placeholder="ìë™ ìƒì„±" />
              </div>
              <div>
                <label for="quoteDate">ê²¬ì ì¼</label>
                <input id="quoteDate" type="date" />
              </div>
              <div>
                <label for="validUntil">ìœ íš¨ê¸°ê°„</label>
                <input id="validUntil" type="date" readonly />
              </div>
            </div>
            <div class="hint">ê²¬ì ì„œ ìœ íš¨ê¸°ê°„ì€ 20ì¼ì…ë‹ˆë‹¤. (ìœ íš¨ê¸°ê°„ ë‚´ 02-6405-4446ìœ¼ë¡œ ë¬¸ì˜)</div>

            <div class="hd" style="margin:6px -16px -2px;border-top:1px solid var(--line)"><b>ì œí’ˆ ì„ íƒ</b><span class="muted">ìˆ˜ëŸ‰ ì…ë ¥ ì‹œ ìë™ ê³„ì‚°</span></div>

            <!-- Recruiter -->
            <div class="row">
              <div>
                <label>ğŸ” Recruiter (ì¸ì¬ê²€ìƒ‰)</label>
                <div class="desc">â€¢ 13ì–µëª… ì¸ì¬ ê²€ìƒ‰
â€¢ ì¸ë§¥ ë¬´ê´€ ë©”ì‹œì§€</div>
              </div>
              <div>
                <label for="qtyRecruiter">ìˆ˜ëŸ‰</label>
                <select id="qtyRecruiter">
                  <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>ê¸ˆì•¡</label>
                <input id="amtRecruiter" readonly />
              </div>
            </div>

            <!-- Job Slot -->
            <div class="row">
              <div>
                <label>ğŸ“Œ Job Slot (ì±„ìš©ê³µê³ )</label>
                <div class="desc">â€¢ ì§ë¬´ë³„ ê³µê³  ìš´ì˜
â€¢ ìƒì‹œ í›„ë³´ì ëª¨ì§‘</div>
              </div>
              <div>
                <label for="qtyJob">ìˆ˜ëŸ‰</label>
                <select id="qtyJob">
                  <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>ê¸ˆì•¡</label>
                <input id="amtJob" readonly />
              </div>
            </div>

            <!-- AI Hiring Assistant -->
            <div class="aiBox">
              <div class="row" style="grid-template-columns:1fr 160px 160px">
                <div>
                  <label>ğŸ¤– AI Hiring Assistant (ì˜µì…˜)</label>
                  <div class="desc">â€¢ JD ì—…ë¡œë“œ â†’ AI í‰ê°€/ì¶”ì²œ
â€¢ ê²€í†  ì‹œê°„ ë‹¨ì¶•</div>
                  <div class="hint">AI Hiring AssistantëŠ” Recruiter ì†”ë£¨ì…˜ + ì˜µì…˜ìƒí’ˆì…ë‹ˆë‹¤.</div>
                </div>
                <div>
                  <label for="aiTier">Tier</label>
                  <select id="aiTier">
                    <option value="none" selected>ì„ íƒ ì•ˆ í•¨</option>
                    <option value="t1">Tier 1</option>
                    <option value="t2">Tier 2</option>
                    <option value="t3">Tier 3</option>
                  </select>
                </div>
                <div>
                  <label>ê¸ˆì•¡</label>
                  <input id="amtAI" readonly />
                </div>
              </div>

              <div class="row" style="grid-template-columns:1fr 160px 160px">
                <div class="desc">â€» 13ì–µëª… í›„ë³´ì ì¤‘ Tierë³„ AIí‰ê°€: Tier1=200, Tier2=800, Tier3=1500</div>
                <div>
                  <label>13ì–µëª… í›„ë³´ì ì¤‘ AIí‰ê°€</label>
                  <input id="aiCapacity" readonly />
                </div>
                <div>
                  <label>ì§€ì›ì ì¤‘ AIí‰ê°€</label>
                  <input id="aiApplicant" readonly />
                </div>
              </div>
            </div>

            <!-- Life Page -->
            <div class="row">
              <div>
                <label>ğŸ“£ Life Page (ê¸°ì—… ë¸Œëœë”©)</label>
                <div class="desc">â€¢ íƒ€ê²Ÿ í™ë³´/íŒ”ë¡œì›Œ í™•ëŒ€
â€¢ ê¸ˆì•¡ì€ ê¸°ì—… ê·œëª¨ì— ë”°ë¼ ìƒì´</div>
              </div>
              <div>
                <label for="lifeInclude">í¬í•¨ ì—¬ë¶€</label>
                <select id="lifeInclude">
                  <option value="no" selected>ë¯¸í¬í•¨</option>
                  <option value="yes">í¬í•¨(ë¬¸ì˜)</option>
                </select>
              </div>
              <div>
                <label>ê¸ˆì•¡</label>
                <input id="amtLife" readonly />
              </div>
            </div>

            <!-- LTI -->
            <div class="row">
              <div>
                <label>ğŸ“Š LTI (ê²½ìŸì‚¬ ë¶„ì„)</label>
                <div class="desc">â€¢ ê²½ìŸì‚¬ ì¸ë ¥/ì—­ëŸ‰ ë¶„ì„
â€¢ ì±„ìš© ì „ëµ ìˆ˜ë¦½</div>
              </div>
              <div>
                <label for="qtyLTI">ìˆ˜ëŸ‰</label>
                <select id="qtyLTI">
                  <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>ê¸ˆì•¡</label>
                <input id="amtLTI" readonly />
              </div>
            </div>
          </div>

          <div class="callout">
            <b>ë¬¸ì˜ ì•ˆë‚´</b><br/>
            â€¢ ê²¬ì ì„œ ìœ íš¨ê¸°ê°„ ë‚´ <b>02-6405-4446</b>ìœ¼ë¡œ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br/>
            â€¢ Life PageëŠ” ê¸°ì—… ê·œëª¨ì— ë”°ë¼ ê¸ˆì•¡ì´ ìƒì´. <b>ë¬¸ì˜í•„ìˆ˜</b>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="hd"><b>ìš”ì•½</b><span class="muted">USD ê¸°ì¤€</span></div>
        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <div class="t">ì´ í•©ê³„</div>
              <div class="v" id="total">-</div>
              <div class="muted">â€» ë¶€ê°€ì„¸ ì—†ìŒ</div>
            </div>
            <div class="kpi">
              <div class="t">ì„ íƒ í•­ëª©</div>
              <div class="v" id="items">-</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <table>
            <thead>
              <tr>
                <th>í•­ëª©</th>
                <th class="right">ë‹¨ê°€(USD)</th>
                <th class="right">ìˆ˜ëŸ‰</th>
                <th class="right">ê¸ˆì•¡(USD)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="right">í•©ê³„</th>
                <th class="right" id="total2">-</th>
              </tr>
            </tfoot>
          </table>

          <div id="minNotice" style="margin-top:10px;font-size:12px;font-weight:800;color:#f87171;display:none;line-height:1.5">
            ê¸°ì—…ìš© ì†”ë£¨ì…˜ì€ ìµœì†Œ í•©ê³„ê¸ˆì•¡ì´ $10,000 ë¶€í„° ê³„ì•½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br/>
            êµ¬ì²´ì ì¸ ë¬¸ì˜ëŠ” Linkedin Korea Partnerë¡œ ì—°ë½ì£¼ì„¸ìš”.
          </div>

          <div class="callout" style="border-color:rgba(52,211,153,.35);background:rgba(52,211,153,.10);color:#d1fae5;margin-top:12px">
            <b>ê¸°ì—…ìš© ì†”ë£¨ì…˜ ë¬¸ì˜</b><br/>
            Linkedin Korea Partner<br/>
            02-6405-4446<br/>
            help@hrpoint.co.kr
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">ì™„ë£Œ</div>
  </div>

  <div class="sticky">
    <div class="inner">
      <div class="muted">ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì…ë ¥ê°’ ê¸°ì¤€ìœ¼ë¡œ ê²¬ì ì„œ(PDF)ê°€ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤. (USD ê¸°ì¤€ Â· ë¶€ê°€ì„¸ ì—†ìŒ)</div>
      <div class="btns">
        <button id="btnCopyLink">ì…ë ¥ê°’ ë§í¬ ë³µì‚¬</button>
        <button id="btnReset">ì´ˆê¸°í™”</button>
        <button class="primary" id="btnPdf">ê²¬ì ì„œ ë‹¤ìš´ë¡œë“œ(PDF)</button>
      </div>
    </div>
  </div>

  <script>
    // ====== ìƒˆ WebApp URL ======
    const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyGUnl2eAXU3Vh9_Y9ZPtdXfVZu_z6OwKczEMzU1EOQibLoroweRa3-X9ksVIPXMhjmSw/exec";

    // ====== PDF í•œê¸€ í°íŠ¸ ë¡œë”©(ê¹¨ì§ ë°©ì§€) ======
    const KOREAN_FONT_URL = "https://cdn.jsdelivr.net/npm/@fontsource/noto-sans-kr/files/noto-sans-kr-korean-400-normal.ttf";
    let __koreanFontB64 = null;
    let __koreanFontLoading = null;

    function __arrayBufferToBase64(buffer) {
      const bytes = new Uint8Array(buffer);
      let binary = "";
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk) {
        binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunk));
      }
      return btoa(binary);
    }

    async function ensureKoreanFont(doc) {
      try { doc.setFont("NotoSansKR"); return; } catch (e) {}
      if (__koreanFontB64) {
        doc.addFileToVFS("NotoSansKR-Regular.ttf", __koreanFontB64);
        doc.addFont("NotoSansKR-Regular.ttf", "NotoSansKR", "normal");
        doc.setFont("NotoSansKR");
        return;
      }
      if (!__koreanFontLoading) {
        __koreanFontLoading = fetch(KOREAN_FONT_URL)
          .then(r => { if (!r.ok) throw new Error("Font download failed"); return r.arrayBuffer(); })
          .then(buf => (__koreanFontB64 = __arrayBufferToBase64(buf)));
      }
      const b64 = await __koreanFontLoading;
      doc.addFileToVFS("NotoSansKR-Regular.ttf", b64);
      doc.addFont("NotoSansKR-Regular.ttf", "NotoSansKR", "normal");
      doc.setFont("NotoSansKR");
    }

    const $ = (id) => document.getElementById(id);

    const toast = (msg='ì™„ë£Œ') => {
      const t = $('toast');
      if (!t) return;
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{t.style.display='none';}, 1600);
    };

    const PRICES = {
      recruiter: 11350,
      job: 2010,
      lti: 12500,
      ai: {
        none: { price: 0, cap: 0, app: 0 },
        t1: { price: 3170, cap: 200, app: 3500 },
        t2: { price: 6910, cap: 800, app: 9000 },
        t3: { price: 10365, cap: 1500, app: 25000 },
      }
    };

    const nfmt = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(Math.round(n || 0));
    const money = (n) => `$${nfmt(n)}`;
    const toNum = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[\s,]/g,'').trim();
      if (!s) return 0;
      const x = Number(s);
      return isFinite(x) ? x : 0;
    };

    const genQuoteNo = () => {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const rnd = Math.random().toString(16).slice(2,6).toUpperCase();
      return `${y}${m}${day}-LK-${rnd}`;
    };

    const addDaysISO = (isoDate, days) => {
      if (!isoDate) return '';
      const d = new Date(isoDate + 'T00:00:00');
      d.setDate(d.getDate() + days);
      return d.toISOString().slice(0,10);
    };

    function setDefaultQuoteFields(){
      const today = new Date().toISOString().slice(0,10);
      if ($('quoteDate') && !$('quoteDate').value) $('quoteDate').value = today;
      if ($('validUntil')) $('validUntil').value = addDaysISO($('quoteDate').value, 20);
      if ($('quoteNo') && !$('quoteNo').value) $('quoteNo').value = genQuoteNo();
    }

    function buildRows(state){
      const rows = [];
      if (state.qtyRecruiter > 0) rows.push({ name:'Recruiter (ì¸ì¬ê²€ìƒ‰)', unit:PRICES.recruiter, qty:state.qtyRecruiter, amount:state.amtRecruiter });
      if (state.qtyJob > 0) rows.push({ name:'Job Slot (ì±„ìš©ê³µê³ )', unit:PRICES.job, qty:state.qtyJob, amount:state.amtJob });
      if (state.aiTier !== 'none') rows.push({ name:`AI Hiring Assistant (Tier ${state.aiTier.slice(1)})`, unit:PRICES.ai[state.aiTier].price, qty:1, amount:state.amtAI });
      if (state.lifeInclude === 'yes') rows.push({ name:'Life Page (ê¸°ì—… ë¸Œëœë”©) â€” ë¬¸ì˜', unit:null, qty:null, amount:null });
      if (state.qtyLTI > 0) rows.push({ name:'LTI (ê²½ìŸì‚¬ ë¶„ì„)', unit:PRICES.lti, qty:state.qtyLTI, amount:state.amtLTI });
      return rows;
    }

    function recalc(){
      if ($('quoteDate')?.value && $('validUntil')) $('validUntil').value = addDaysISO($('quoteDate').value, 20);

      const aiTier = $('aiTier')?.value || 'none';
      const qtyRecruiter = toNum($('qtyRecruiter')?.value);
      const qtyJob = toNum($('qtyJob')?.value);
      const qtyLTI = toNum($('qtyLTI')?.value);
      const lifeInclude = $('lifeInclude')?.value || 'no';

      const amtRecruiter = qtyRecruiter * PRICES.recruiter;
      const amtJob = qtyJob * PRICES.job;
      const amtAI = PRICES.ai[aiTier]?.price || 0;
      const amtLTI = qtyLTI * PRICES.lti;

      const total = amtRecruiter + amtJob + amtAI + amtLTI;

      $('amtRecruiter').value = money(amtRecruiter);
      $('amtJob').value = money(amtJob);
      $('amtAI').value = money(amtAI);
      $('amtLTI').value = money(amtLTI);
      $('amtLife').value = (lifeInclude === 'yes') ? 'ë¬¸ì˜' : '-';

      // AI í‘œì‹œ(ìš”ì²­ ë°˜ì˜)
      if (aiTier === 'none') {
        $('aiCapacity').value = 'ì„ íƒ ì•ˆ í•¨';
        $('aiApplicant').value = 'ì„ íƒ ì•ˆ í•¨';
      } else {
        $('aiCapacity').value = `${nfmt(PRICES.ai[aiTier].cap)}ëª…`;
        $('aiApplicant').value = `${nfmt(PRICES.ai[aiTier].app)}ëª…`;
      }

      $('total').textContent = money(total);
      $('total2').textContent = money(total);

      const rows = buildRows({ aiTier, qtyRecruiter, qtyJob, qtyLTI, lifeInclude, amtRecruiter, amtAI, amtJob, amtLTI, total });
      $('items').textContent = rows.length ? `${rows.length}ê°œ í•­ëª©` : '-';

      const minNotice = document.getElementById('minNotice');
      if (minNotice) minNotice.style.display = (total > 0 && total < 10000) ? 'block' : 'none';

      const tb = $('tbody');
      tb.innerHTML = rows.length ? rows.map(r => {
        const unit = (r.unit == null) ? 'ë¬¸ì˜' : money(r.unit);
        const qty = (r.qty == null) ? '-' : nfmt(r.qty);
        const amt = (r.amount == null) ? 'ë¬¸ì˜' : money(r.amount);
        return `<tr><td>${r.name}</td><td class="right">${unit}</td><td class="right">${qty}</td><td class="right">${amt}</td></tr>`;
      }).join('') : `<tr><td colspan="4" class="muted">ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;

      return { total, rows, aiTier };
    }

    async function saveToSheet(payload){
      try {
        const url = GAS_WEBAPP_URL + "?_ts=" + Date.now();
        await fetch(url, {
          method: 'POST',
          mode: 'no-cors',
          credentials: 'omit',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: new URLSearchParams(payload).toString(),
          cache: 'no-store',
          redirect: 'follow'
        });
      } catch(e) {}
    }

    function buildSheetPayload(total, rows, aiTier){
      const selectedSummary = rows
        .map(r => (r.unit == null) ? `${r.name}` : `${r.name} x${r.qty}`)
        .join(' + ');

      return {
        savedAt: new Date().toISOString(),
        quoteNo: $('quoteNo')?.value || '',
        companyName: $('company')?.value || '',
        contactName: $('contact')?.value || '',
        contactEmail: $('email')?.value || '',
        currency: 'USD',
        totalUSD: String(total),
        selectedCount: String(rows.length),
        selectedSummary: selectedSummary || '-',
        aiTier: aiTier || 'none',
        pageUrl: location.href,
        userAgent: navigator.userAgent,
      };
    }

    async function makePdf(){
      setDefaultQuoteFields();
      const { total, rows, aiTier } = recalc();
      if (!rows.length) { toast('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }

      const company = $('company').value || '';
      const contact = $('contact').value || '';
      const email = $('email').value || '';
      const quoteNo = $('quoteNo').value || genQuoteNo();
      const quoteDate = $('quoteDate').value || new Date().toISOString().slice(0,10);
      const validUntil = $('validUntil').value || addDaysISO(quoteDate, 20);

      $('quoteNo').value = quoteNo;
      $('quoteDate').value = quoteDate;
      $('validUntil').value = validUntil;

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit:'pt', format:'a4' });

      await ensureKoreanFont(doc);
      doc.setFont('NotoSansKR');

      const marginX = 44;
      let y = 60;

      // ìƒë‹¨ ì œëª©(ìš”ì²­)
      doc.setFontSize(22);
      doc.text('Linkedin Solution ê²¬ì ì„œ', marginX, y);
      y += 22;

      doc.setFontSize(10);
      doc.text(`ê²¬ì ë²ˆí˜¸: ${quoteNo}`, marginX, y);
      doc.text(`ê²¬ì ì¼: ${quoteDate}`, 360, y);
      y += 14;

      doc.text(`ìœ íš¨ê¸°ê°„: ${validUntil} (20ì¼)`, marginX, y);
      y += 14;

      doc.text('VAT: None', marginX, y);
      y += 18;

      doc.text(`íšŒì‚¬ëª…: ${company}`, marginX, y);
      y += 14;
      doc.text(`ë‹´ë‹¹ì: ${contact}`, marginX, y);
      doc.text(`ì´ë©”ì¼: ${email}`, 360, y);
      y += 18;

      const body = rows.map(r => {
        const unit = (r.unit == null) ? 'ë¬¸ì˜' : money(r.unit);
        const qty = (r.qty == null) ? '-' : String(r.qty);
        const amt = (r.amount == null) ? 'ë¬¸ì˜' : money(r.amount);
        return [r.name, unit, qty, amt];
      });

      doc.autoTable({
        startY: y,
        head: [[ 'Item', 'Unit Price (USD)', 'Qty', 'Amount (USD)' ]],
        body,
        styles: { font: 'NotoSansKR', fontSize: 9, cellPadding: 6 },
        headStyles: { fillColor: [11, 18, 32] },
        columnStyles: { 1: { halign: 'right' }, 2: { halign: 'right' }, 3: { halign: 'right' } },
        margin: { left: marginX, right: marginX },
      });

      const endY = doc.lastAutoTable.finalY + 16;
      doc.setFontSize(12);
      doc.text(`Total (USD): ${money(total)}`, 360, endY);

      // í•˜ë‹¨ ì¤‘ì•™ Partner ë¬¸êµ¬(ìš”ì²­)
      const pageH = doc.internal.pageSize.getHeight();
      doc.setFontSize(10);
      doc.text('Linkedin Korea Partner', doc.internal.pageSize.getWidth()/2, pageH - 36, { align: 'center' });

      doc.save(`LinkedIn_Quotation_${quoteNo}.pdf`);
    }

    async function onDownload(){
      setDefaultQuoteFields();
      const { total, rows, aiTier } = recalc();
      await saveToSheet(buildSheetPayload(total, rows, aiTier));
      await makePdf();
    }

    async function copyLink(){
      const p = new URLSearchParams({
        company: $('company').value || '',
        contact: $('contact').value || '',
        email: $('email').value || '',
        quoteNo: $('quoteNo').value || '',
        quoteDate: $('quoteDate').value || '',
        qtyRecruiter: $('qtyRecruiter').value || '0',
        qtyJob: $('qtyJob').value || '0',
        aiTier: $('aiTier').value || 'none',
        lifeInclude: $('lifeInclude').value || 'no',
        qtyLTI: $('qtyLTI').value || '0'
      });
      const url = `${location.origin}${location.pathname}?${p.toString()}`;
      try { await navigator.clipboard.writeText(url); toast('ì…ë ¥ê°’ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
      catch(e){ toast('ë³µì‚¬ ì‹¤íŒ¨'); }
    }

    function applyStateFromLink(){
      const p = new URLSearchParams(location.search);
      const set = (id, key) => { if (p.has(key) && $(id)) $(id).value = p.get(key); };
      set('company','company');
      set('contact','contact');
      set('email','email');
      set('quoteNo','quoteNo');
      set('quoteDate','quoteDate');
      set('qtyRecruiter','qtyRecruiter');
      set('qtyJob','qtyJob');
      set('aiTier','aiTier');
      set('lifeInclude','lifeInclude');
      set('qtyLTI','qtyLTI');
    }

    function resetAll(){
      $('company').value='';
      $('contact').value='';
      $('email').value='';
      $('quoteNo').value='';
      $('quoteDate').value='';
      $('qtyRecruiter').value='0';
      $('qtyJob').value='0';
      $('aiTier').value='none';
      $('lifeInclude').value='no';
      $('qtyLTI').value='0';
      history.replaceState({}, '', location.pathname);
      setDefaultQuoteFields();
      recalc();
      toast('ì´ˆê¸°í™” ì™„ë£Œ');
    }

    document.getElementById('btnPdf')?.addEventListener('click', async (e)=>{ e.preventDefault(); await onDownload(); });
    document.getElementById('btnCopyLink')?.addEventListener('click', async (e)=>{ e.preventDefault(); await copyLink(); });
    document.getElementById('btnReset')?.addEventListener('click', (e)=>{ e.preventDefault(); resetAll(); });

    ['company','contact','email','quoteNo','quoteDate','qtyRecruiter','qtyJob','aiTier','lifeInclude','qtyLTI'].forEach(id=>{
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', ()=>{ setDefaultQuoteFields(); recalc(); });
      el.addEventListener('change', ()=>{ setDefaultQuoteFields(); recalc(); });
    });

    applyStateFromLink();
    setDefaultQuoteFields();
    recalc();
  </script>
</body>
</html>
