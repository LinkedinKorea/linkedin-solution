<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkedIn ê¸°ì—…ìš© ì†”ë£¨ì…˜ ìë™ ê²¬ì ì„œ</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#111827;
      --muted:#9ca3af;
      --text:#e5e7eb;
      --line:#1f2937;
      --soft:#0b1220;
      --warn:#f87171;
      --btn:#2563eb;
      --btn2:#1d4ed8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial;
      background:linear-gradient(180deg,#070a0f,#0b0f14 40%);
      color:var(--text);
    }
    .wrap{max-width:1120px;margin:0 auto;padding:26px 16px 120px}
    .top{display:flex;gap:12px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:-.2px}
    .sub{margin:8px 0 0;color:var(--muted);line-height:1.55;font-size:13px}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      background:rgba(96,165,250,.12);border:1px solid rgba(96,165,250,.25);
      color:#cfe6ff;padding:8px 10px;border-radius:999px;font-size:12px
    }

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{
      background:rgba(17,24,39,.72);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:0 12px 30px rgba(0,0,0,.25);
      overflow:hidden
    }
    .hd{
      padding:14px 16px;border-bottom:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .hd b{font-size:14px}
    .meta{font-size:11px;color:var(--muted)}
    .bd{padding:14px 16px}

    .sectionBox{
      background:rgba(11,18,32,.45);
      border:1px solid rgba(31,41,55,.9);
      border-radius:16px;
      padding:12px;
      margin:10px 0 14px;
    }
    .sectionTitle{
      display:flex;align-items:center;justify-content:space-between;
      margin:0 0 10px;
      font-weight:900;
      font-size:13px;
      letter-spacing:-.2px;
    }
    .sectionHint{font-size:11px;color:var(--muted);font-weight:600}

    label{display:block;font-size:12px;color:#cbd5e1;margin-bottom:6px}
    input, select{
      width:100%;padding:12px 12px;border-radius:12px;
      border:1px solid var(--line);background:var(--soft);color:var(--text);
      outline:none;font-family:inherit;font-size:13px
    }
    input:focus, select:focus{border-color:rgba(96,165,250,.6);box-shadow:0 0 0 3px rgba(96,165,250,.14)}
    input[readonly]{opacity:.92}
    .noPick{pointer-events:none; user-select:none; opacity:.95;}

    .rows{display:grid;gap:14px}
    .row{display:grid;grid-template-columns:1fr 160px 160px;gap:12px;align-items:end;padding:10px 0}
    @media (max-width:720px){.row{grid-template-columns:1fr}}

    .hint{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.35;min-height:16px}
    .desc{color:var(--muted);font-size:12px;line-height:1.5;margin-top:4px;white-space:pre-line}

    .productRow{border-top:1px solid rgba(31,41,55,.85)}
    .productRow:first-child{border-top:none}

    /* âœ… í…Œì´ë¸” */
    table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
    th, td{
      padding:10px 10px;border-bottom:1px solid var(--line);vertical-align:top;
      word-break:break-word; overflow-wrap:anywhere;
    }
    th{font-size:12px;color:#cbd5e1;text-align:left;background:rgba(11,18,32,.35)}
    td{font-size:13px}
    .right{text-align:right}

    .kpis{display:grid;gap:10px}
    .kpi{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(11,18,32,.55)}
    .kpi .t{font-size:12px;color:var(--muted)}
    .kpi .v{font-size:28px;font-weight:1000;margin-top:6px;letter-spacing:-.3px}
    .kpi .v.smallItems{font-size:14px;font-weight:650;line-height:1.4}
    .vatSmall{font-size:10px;color:var(--muted);margin-top:6px}
    .annualTiny{font-size:11px;color:var(--muted);font-weight:700;margin-left:8px}

    .callout{
      margin-top:12px;padding:10px 12px;border-radius:14px;
      border:1px solid rgba(96,165,250,.25);background:rgba(96,165,250,.08);
      color:#dbeafe;font-size:12px;line-height:1.55
    }
    .callout.green{
      border-color:rgba(52,211,153,.35);
      background:rgba(52,211,153,.10);
      color:#d1fae5
    }

    .aiBox{
      border:1px dashed rgba(96,165,250,.35);
      background:rgba(96,165,250,.06);
      border-radius:16px;
      padding:12px;
    }

    .sticky{
      position:fixed;left:0;right:0;bottom:0;padding:14px 14px;
      background:rgba(8,12,18,.72);backdrop-filter:blur(10px);
      border-top:1px solid var(--line)
    }
    .sticky .inner{
      max-width:1120px;margin:0 auto;
      display:flex;gap:10px;align-items:center;justify-content:space-between;
    }
    .stickyLeft{flex:0 0 auto;display:flex;gap:10px;align-items:center}
    .stickyCenter{flex:1 1 auto;text-align:center;color:var(--muted);font-size:11px;line-height:1.3;padding:0 8px}
    .stickyRight{flex:0 0 auto;display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap}
    @media (max-width:720px){
      .sticky .inner{flex-wrap:wrap}
      .stickyCenter{order:3;flex:1 1 100%;text-align:left}
    }

    button{
      appearance:none;border:1px solid var(--line);background:var(--soft);color:var(--text);
      padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;font-size:13px
    }
    button.primary{
      border-color:rgba(37,99,235,.55);
      background:linear-gradient(180deg,var(--btn),var(--btn2));
      box-shadow:0 10px 18px rgba(37,99,235,.18);
    }
    button:hover{filter:brightness(1.07)}

    .toast{
      position:fixed;left:50%;bottom:80px;transform:translateX(-50%);
      background:rgba(17,24,39,.92);border:1px solid var(--line);
      padding:10px 12px;border-radius:12px;box-shadow:0 12px 24px rgba(0,0,0,.35);
      font-size:13px;display:none;z-index:9999
    }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .muted{color:var(--muted)}

    /* âœ… PDF ìº¡ì²˜ ì „ìš©: A4 ì—¬ë°± 30mm ëŠë‚Œ + í°íŠ¸ ë¶„ë¦¬(ì˜ë¬¸ Arial / í•œê¸€ ë§‘ì€ê³ ë”•) */
    #pdfCaptureRoot{
      position:fixed;
      left:-99999px; top:0;
      width:794px;
      background:#ffffff;
      color:#000;
      padding:113px; /* 30mm ëŠë‚Œ */
      z-index:-1;
      font-family:"Malgun Gothic","ë§‘ì€ ê³ ë”•","Arial","Apple SD Gothic Neo","Noto Sans KR",sans-serif;
    }
    #pdfCaptureRoot *{
      box-sizing:border-box;
    }
    .pdf-ko{font-family:"Malgun Gothic","ë§‘ì€ ê³ ë”•","Apple SD Gothic Neo","Noto Sans KR",sans-serif;}
    .pdf-en{font-family:"Arial",sans-serif;}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>LinkedIn ê¸°ì—…ìš© ì†”ë£¨ì…˜ ìë™ ê²¬ì ì„œ</h1>
        <div class="sub">
          ê³ ê°ì´ ì§ì ‘ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ <b>USD ê¸°ì¤€ ê²¬ì </b>ì„ ê³„ì‚°í•˜ê³ , ë§¨ í•˜ë‹¨ ë²„íŠ¼ìœ¼ë¡œ <b>ê²¬ì ì„œ(PDF)</b>ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          <br/>â€» í‘œê¸° ê¸ˆì•¡ì€ ë‹¨ê°€ ê¸°ì¤€ì´ë©°, ì‹¤ì œ ê³„ì•½/ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <b>ë§¤ë…„ 7ì›” 1ì¼ë¶€í„° ê¸ˆì•¡ì´ ì¸ìƒë©ë‹ˆë‹¤.</b>
        </div>
      </div>
      <div class="pill">ë¶€ê°€ì„¸ ì—†ìŒ Â· USD ê¸°ì¤€</div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="hd"><b>ì…ë ¥</b><span class="meta">ì „ì²´ ì…ë ¥ê°’ì€ PDFì— í¬í•¨ë©ë‹ˆë‹¤</span></div>
        <div class="bd">
          <div class="sectionBox" style="background:rgba(12,21,40,.45)">
            <div class="sectionTitle">
              <span>ê³ ê°ì •ë³´</span>
              <span class="sectionHint">PDFì™€ í•¨ê»˜ ì¶œë ¥ë©ë‹ˆë‹¤</span>
            </div>

            <div class="rows">
              <div class="row" style="grid-template-columns:1fr 1fr 1fr;align-items:end;padding-top:0">
                <div>
                  <label for="company">íšŒì‚¬ëª… <span style="color:#fca5a5">*</span></label>
                  <input id="company" placeholder="ì˜ˆ: ãˆœí™ê¸¸ë™" />
                </div>
                <div>
                  <label for="contact">ë‹´ë‹¹ìëª… <span style="color:#fca5a5">*</span></label>
                  <input id="contact" placeholder="ì˜ˆ: í™ê¸¸ë™" />
                </div>
                <div>
                  <label for="email">ì´ë©”ì¼ <span style="color:#fca5a5">*</span></label>
                  <input id="email" placeholder="ì˜ˆ: hr@company.com" />
                </div>
              </div>

              <div class="row" style="grid-template-columns:1fr 1fr 1fr;align-items:end">
                <div>
                  <label for="quoteNo">ê²¬ì ë²ˆí˜¸</label>
                  <input id="quoteNo" class="mono" placeholder="ìë™ ìƒì„±" readonly />
                </div>
                <div>
                  <label for="quoteDate">ê²¬ì ì¼</label>
                  <input id="quoteDate" type="date" class="noPick" readonly />
                </div>
                <div>
                  <label for="validUntil">ìœ íš¨ê¸°ê°„</label>
                  <input id="validUntil" type="date" class="noPick" readonly />
                </div>
              </div>

              <div class="hint">ê²¬ì ì„œ ìœ íš¨ê¸°ê°„ì€ 20ì¼ì…ë‹ˆë‹¤. (ìœ íš¨ê¸°ê°„ ë‚´ 02-6405-4446ìœ¼ë¡œ ë¬¸ì˜)</div>
            </div>
          </div>

          <div class="sectionBox" style="background:rgba(11,18,32,.35)">
            <div class="sectionTitle">
              <span>ì œí’ˆì„ íƒ</span>
              <span class="sectionHint">ìˆ˜ëŸ‰ ì…ë ¥ì‹œ ìë™ê³„ì‚°</span>
            </div>

            <div class="rows">
              <div class="row productRow" style="padding-top:0">
                <div>
                  <label>ğŸ” Recruiter</label>
                  <div class="desc">â€¢ 13ì–µëª… ì¸ì¬ ê²€ìƒ‰
â€¢ ì¸ë§¥ë¬´ê´€ ë©”ì‹œì§€ ë°œì†¡ê°€ëŠ¥</div>
                </div>
                <div>
                  <label for="qtyRecruiter">ìˆ˜ëŸ‰</label>
                  <select id="qtyRecruiter">
                    <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                    <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                    <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                  </select>
                </div>
                <div>
                  <label>ê¸ˆì•¡</label>
                  <input id="amtRecruiter" readonly />
                </div>
              </div>

              <div class="row productRow">
                <div>
                  <label>ğŸ“Œ Job Slot</label>
                  <div class="desc">â€¢ ì§ë¬´ë³„ ê³µê³  ìš´ì˜
â€¢ ìƒì‹œ í›„ë³´ì ëª¨ì§‘</div>
                </div>
                <div>
                  <label for="qtyJob">ìˆ˜ëŸ‰</label>
                  <select id="qtyJob">
                    <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                    <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                    <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                  </select>
                </div>
                <div>
                  <label>ê¸ˆì•¡</label>
                  <input id="amtJob" readonly />
                </div>
              </div>

              <div class="aiBox productRow">
                <div class="row" style="grid-template-columns:1fr 160px 160px;padding-top:0">
                  <div>
                    <label>ğŸ¤– AI Hiring Assistant</label>
                    <div class="desc">â€¢ JD ì—…ë¡œë“œ â†’ AI í‰ê°€/ì¶”ì²œ
â€¢ ê²€í†  ì‹œê°„ ë‹¨ì¶•</div>
                    <div class="hint">AI Hiring AssistantëŠ”<br/>Recruiter ì†”ë£¨ì…˜ + ì˜µì…˜ìƒí’ˆì…ë‹ˆë‹¤.</div>
                  </div>
                  <div>
                    <label for="aiTier">Tier</label>
                    <select id="aiTier">
                      <option value="none" selected>ì„ íƒ ì•ˆ í•¨</option>
                      <option value="t1">Tier 1</option>
                      <option value="t2">Tier 2</option>
                      <option value="t3">Tier 3</option>
                    </select>
                  </div>
                  <div>
                    <label>ê¸ˆì•¡</label>
                    <input id="amtAI" readonly />
                  </div>
                </div>

                <div class="row" style="grid-template-columns:1fr 160px 160px">
                  <div class="desc muted">â€» Tier ì„¤ëª…ì€ PDFì˜ ì°¸ê³ ì‚¬í•­ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                  <div>
                    <label>13ì–µëª… í›„ë³´ì AIí‰ê°€ ë° ì¶”ì²œ</label>
                    <input id="aiCapacity" readonly />
                  </div>
                  <div>
                    <label>ì±„ìš©ê³µê³  ì§€ì›ì ì¤‘ AIí‰ê°€</label>
                    <input id="aiApplicant" readonly />
                  </div>
                </div>
              </div>

              <div class="row productRow">
                <div>
                  <label>ğŸ“£ Life Page</label>
                  <div class="desc">â€¢ íƒ€ê²Ÿ í™ë³´/íŒ”ë¡œì›Œ í™•ëŒ€
â€¢ ê¸ˆì•¡ì€ ê¸°ì—… ê·œëª¨ì— ë”°ë¼ ìƒì´</div>
                </div>
                <div>
                  <label for="lifeInclude">í¬í•¨ ì—¬ë¶€</label>
                  <select id="lifeInclude">
                    <option value="no" selected>ë¯¸í¬í•¨</option>
                    <option value="yes">í¬í•¨(ë¬¸ì˜)</option>
                  </select>
                </div>
                <div>
                  <label>ê¸ˆì•¡</label>
                  <input id="amtLife" readonly />
                </div>
              </div>

              <div class="row productRow" style="padding-bottom:0">
                <div>
                  <label>ğŸ“Š LTI</label>
                  <div class="desc">â€¢ ê²½ìŸì‚¬ ì¸ë ¥/ì—­ëŸ‰ ë¶„ì„
â€¢ ì±„ìš© ì „ëµ ìˆ˜ë¦½</div>
                </div>
                <div>
                  <label for="qtyLTI">ìˆ˜ëŸ‰</label>
                  <select id="qtyLTI">
                    <option value="0" selected>ì„ íƒ ì•ˆ í•¨</option>
                    <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                    <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                  </select>
                </div>
                <div>
                  <label>ê¸ˆì•¡</label>
                  <input id="amtLTI" readonly />
                </div>
              </div>
            </div>
          </div>

          <div class="callout">
            <b>ë¬¸ì˜ ì•ˆë‚´</b><br/>
            â€¢ ê²¬ì ì„œ ìœ íš¨ê¸°ê°„ ë‚´ <b>02-6405-4446</b>ìœ¼ë¡œ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br/>
            â€¢ Life PageëŠ” ê¸°ì—… ê·œëª¨ì— ë”°ë¼ ê¸ˆì•¡ì´ ìƒì´. <b>Korea Partnerë¡œ ë¬¸ì˜ í•„ìˆ˜</b>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="hd"><b>ê²¬ì ì„œ ìë™ì‚°ì¶œìš”ì•½</b><span class="meta">USD ê¸°ì¤€</span></div>
        <div class="bd" id="summaryBox">
          <div class="kpis">
            <div class="kpi">
              <div class="t">
                ì´ í•©ê³„
                <span class="annualTiny">&nbsp;&nbsp;&nbsp;/ì—°ê°„ê¸ˆì•¡</span>
              </div>
              <div class="v" id="total">-</div>
              <div class="vatSmall">â€» ë¶€ê°€ì„¸ ì—†ìŒ</div>
            </div>

            <div class="kpi">
              <div class="t">ì„ íƒ í•­ëª©</div>
              <div class="v smallItems" id="items">-</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <table>
            <thead>
              <tr>
                <th style="width:42%">í•­ëª©</th>
                <th class="right" style="width:18%">ë‹¨ê°€(USD)</th>
                <th class="right" style="width:12%">ìˆ˜ëŸ‰</th>
                <th class="right" style="width:28%">ê¸ˆì•¡(USD)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="right">í•©ê³„</th>
                <th class="right" id="total2">-</th>
              </tr>
            </tfoot>
          </table>

          <div class="callout green" style="margin-top:12px">
            <b>ê¸°ì—…ìš© ì†”ë£¨ì…˜ ë¬¸ì˜</b><br/>
            Linkedin Korea Partner<br/>
            02-6405-4446<br/>
            help@hrpoint.co.kr
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">ì™„ë£Œ</div>
  </div>

  <div id="pdfCaptureRoot" aria-hidden="true"></div>

  <div class="sticky">
    <div class="inner">
      <div class="stickyLeft">
        <button id="btnReset">ì´ˆê¸°í™”</button>
      </div>
      <div class="stickyCenter">
        ê²¬ì ì„œëŠ” PDFë¡œ ë‹¤ìš´ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ë³¸ ê²¬ì ì„œëŠ” ë‹¨ìˆœ ì°¸ê³ ìš©ì…ë‹ˆë‹¤.
      </div>
      <div class="stickyRight">
        <button id="btnCopyLink">ê²¬ì ì„œ ê²°ê³¼ ë§í¬ë³µì‚¬</button>
        <button class="primary" id="btnPdf">ê²¬ì ì„œ ë‹¤ìš´ë¡œë“œ(PDF)</button>
      </div>
    </div>
  </div>

  <script>
    const GAS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyGUnl2eAXU3Vh9_Y9ZPtdXfVZu_z6OwKczEMzU1EOQibLoroweRa3-X9ksVIPXMhjmSw/exec";
    const $ = (id) => document.getElementById(id);

    const toast = (msg='ì™„ë£Œ') => {
      const t = $('toast');
      if (!t) return;
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{t.style.display='none';}, 1600);
    };

    const PRICES = {
      recruiter: 11350,
      job: 2010,
      lti: 12500,
      ai: {
        none: { price: 0, cap: 0, app: 0 },
        t1: { price: 3170, cap: 200, app: 3500 },
        t2: { price: 6910, cap: 800, app: 9000 },
        t3: { price: 10365, cap: 1500, app: 25000 },
      }
    };

    const nfmt = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(Math.round(n || 0));
    const money = (n) => `$${nfmt(n)}`;
    const moneyAnnual = (n) => `${money(n)} <span style="font-size:11px;color:#6b7280;font-weight:700;">/ì—°ê°„</span>`;
    const moneyAnnualPlain = (n) => `${money(n)} /ì—°ê°„`;

    const toNum = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[\s,]/g,'').trim();
      if (!s) return 0;
      const x = Number(s);
      return isFinite(x) ? x : 0;
    };

    const genQuoteNo = () => {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const rnd = Math.random().toString(16).slice(2,6).toUpperCase();
      return `${y}${m}${day}-LK-${rnd}`;
    };

    const addDaysISO = (isoDate, days) => {
      if (!isoDate) return '';
      const d = new Date(isoDate + 'T00:00:00');
      d.setDate(d.getDate() + days);
      return d.toISOString().slice(0,10);
    };

    function validateRequired(){
      const company = ($('company')?.value || '').trim();
      const contact = ($('contact')?.value || '').trim();
      const email = ($('email')?.value || '').trim();

      if (!company){ toast('íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); $('company')?.focus(); return false; }
      if (!contact){ toast('ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); $('contact')?.focus(); return false; }
      if (!email){ toast('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); $('email')?.focus(); return false; }

      const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!ok){ toast('ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.'); $('email')?.focus(); return false; }
      return true;
    }

    function getProductSignature(){
      const sigObj = {
        qtyRecruiter: $('qtyRecruiter')?.value || '0',
        qtyJob: $('qtyJob')?.value || '0',
        aiTier: $('aiTier')?.value || 'none',
        lifeInclude: $('lifeInclude')?.value || 'no',
        qtyLTI: $('qtyLTI')?.value || '0'
      };
      return JSON.stringify(sigObj);
    }

    function syncQuoteNoBySignature(){
      const sig = getProductSignature();
      const lastSig = localStorage.getItem('lk_quote_sig');
      const lastNo = localStorage.getItem('lk_quote_no');

      if (lastSig === sig && lastNo) {
        $('quoteNo').value = lastNo;
        return lastNo;
      }
      const newNo = genQuoteNo();
      $('quoteNo').value = newNo;
      localStorage.setItem('lk_quote_sig', sig);
      localStorage.setItem('lk_quote_no', newNo);
      return newNo;
    }

    function setDefaultQuoteFields(){
      const today = new Date().toISOString().slice(0,10);

      if ($('quoteDate')) {
        $('quoteDate').value = today;
        $('quoteDate').setAttribute('readonly','readonly');
        $('quoteDate').classList.add('noPick');
      }

      if ($('validUntil')) {
        $('validUntil').value = addDaysISO(today, 20);
        $('validUntil').setAttribute('readonly','readonly');
        $('validUntil').classList.add('noPick');
      }

      if ($('quoteNo')) {
        $('quoteNo').setAttribute('readonly','readonly');
        syncQuoteNoBySignature();
      }
    }

    function buildRows(state){
      const rows = [];
      if (state.qtyRecruiter > 0)
        rows.push({ name:'Recruiter (ì¸ì¬ê²€ìƒ‰)', unit:PRICES.recruiter, qty:state.qtyRecruiter, amount:state.amtRecruiter });

      if (state.qtyJob > 0)
        rows.push({ name:'Job Slot (ì±„ìš©ê³µê³ )', unit:PRICES.job, qty:state.qtyJob, amount:state.amtJob });

      if (state.aiTier !== 'none')
        rows.push({ name:`AI Hiring Assistant (Tier ${state.aiTier.slice(1)})`, unit:PRICES.ai[state.aiTier].price, qty:1, amount:state.amtAI });

      if (state.lifeInclude === 'yes')
        rows.push({ name:'Life Page (ê¸°ì—…ë¸Œëœë”©)', unit:null, qty:null, amount:null });

      if (state.qtyLTI > 0)
        rows.push({ name:'LTI (ê²½ìŸì‚¬ ë¶„ì„)', unit:PRICES.lti, qty:state.qtyLTI, amount:state.amtLTI });

      return rows;
    }

    function recalc(){
      const quoteNo = syncQuoteNoBySignature();

      const aiTier = $('aiTier')?.value || 'none';
      const qtyRecruiter = toNum($('qtyRecruiter')?.value);
      const qtyJob = toNum($('qtyJob')?.value);
      const qtyLTI = toNum($('qtyLTI')?.value);
      const lifeInclude = $('lifeInclude')?.value || 'no';

      const amtRecruiter = qtyRecruiter * PRICES.recruiter;
      const amtJob = qtyJob * PRICES.job;
      const amtAI = PRICES.ai[aiTier]?.price || 0;
      const amtLTI = qtyLTI * PRICES.lti;
      const total = amtRecruiter + amtJob + amtAI + amtLTI;

      // âœ… ê³„ì‚°ê¸°: ê° ê¸ˆì•¡ ë’¤ì— /ì—°ê°„ í‘œì‹œ
      $('amtRecruiter').value = amtRecruiter ? `${money(amtRecruiter)} /ì—°ê°„` : `${money(0)} /ì—°ê°„`;
      $('amtJob').value = amtJob ? `${money(amtJob)} /ì—°ê°„` : `${money(0)} /ì—°ê°„`;
      $('amtAI').value = (aiTier === 'none') ? `${money(0)} /ì—°ê°„` : `${money(amtAI)} /ì—°ê°„`;
      $('amtLTI').value = amtLTI ? `${money(amtLTI)} /ì—°ê°„` : `${money(0)} /ì—°ê°„`;
      $('amtLife').value = (lifeInclude === 'yes') ? 'ë¬¸ì˜' : '-';

      if (aiTier === 'none') {
        $('aiCapacity').value = 'ì„ íƒ ì•ˆ í•¨';
        $('aiApplicant').value = 'ì„ íƒ ì•ˆ í•¨';
      } else {
        $('aiCapacity').value = `${nfmt(PRICES.ai[aiTier].cap)}ëª…`;
        $('aiApplicant').value = `${nfmt(PRICES.ai[aiTier].app)}ëª…`;
      }

      // âœ… ì´í•©ê³„: /ì—°ê°„ê¸ˆì•¡ í‘œì‹œ(ì‘ê²Œ)
      $('total').innerHTML = `${money(total)} <span style="font-size:12px;color:#9ca3af;font-weight:800;margin-left:10px;">/ì—°ê°„ê¸ˆì•¡</span>`;
      $('total2').innerHTML = `${money(total)} <span style="font-size:11px;color:#9ca3af;font-weight:800;margin-left:8px;">/ì—°ê°„ê¸ˆì•¡</span>`;

      const rows = buildRows({ aiTier, qtyRecruiter, qtyJob, qtyLTI, lifeInclude, amtRecruiter, amtAI, amtJob, amtLTI, total });

      if (!rows.length) {
        $('items').textContent = '-';
      } else {
        const names = rows.map(r => {
          if (r.unit == null) return r.name;
          if (r.name.startsWith('AI Hiring Assistant')) return r.name;
          return r.qty > 1 ? `${r.name} x${r.qty}` : r.name;
        });
        $('items').textContent = names.join(', ');
      }

      const tb = $('tbody');
      tb.innerHTML = rows.length ? rows.map(r => {
        const unit = (r.unit == null) ? 'ë¬¸ì˜' : money(r.unit);
        const qty = (r.qty == null) ? '-' : nfmt(r.qty);
        const amt = (r.amount == null) ? 'ë¬¸ì˜' : `${money(r.amount)} /ì—°ê°„`;
        return `<tr><td>${r.name}</td><td class="right">${unit}</td><td class="right">${qty}</td><td class="right">${amt}</td></tr>`;
      }).join('') : `<tr><td colspan="4" class="muted">ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;

      return { total, rows, aiTier, quoteNo, amtRecruiter, amtJob, amtAI, amtLTI };
    }

    function getSheetLogKey(quoteNo){
      return `lk_sheet_logged_${quoteNo}`;
    }

    async function saveToSheetOnce(payload){
      const quoteNo = payload.quoteNo || '';
      if (!quoteNo) return;

      const key = getSheetLogKey(quoteNo);
      if (localStorage.getItem(key)) return;

      localStorage.setItem(key, String(Date.now()));

      try {
        const url = GAS_WEBAPP_URL + "?_ts=" + Date.now();
        await fetch(url, {
          method: 'POST',
          mode: 'no-cors',
          credentials: 'omit',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: new URLSearchParams(payload).toString(),
          cache: 'no-store',
          redirect: 'follow'
        });
      } catch(e) {
        localStorage.removeItem(key);
      }
    }

    function buildSheetPayload(total, rows, aiTier){
      const selectedSummary = rows.map(r => (r.unit == null) ? `${r.name}` : `${r.name} x${r.qty}`).join(' + ');
      return {
        savedAt: new Date().toISOString(),
        quoteNo: $('quoteNo')?.value || '',
        companyName: $('company')?.value || '',
        contactName: $('contact')?.value || '',
        contactEmail: $('email')?.value || '',
        currency: 'USD',
        totalUSD: String(total),
        selectedCount: String(rows.length),
        selectedSummary: selectedSummary || '-',
        aiTier: aiTier || 'none',
        pageUrl: location.href,
        userAgent: navigator.userAgent,
      };
    }

    function fileStamp(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      return `${y}${m}${day}_${hh}${mm}`;
    }

    function tierNoteHtml(aiTier){
      if (!aiTier || aiTier === 'none') return '';
      const cap = PRICES.ai[aiTier]?.cap || 0;
      const app = PRICES.ai[aiTier]?.app || 0;
      const tierLabel = `Tier ${aiTier.slice(1)}`;
      return `
        <div class="pdf-ko" style="margin-top:14px;font-size:10.5px;color:#000;line-height:1.7;">
          <b>ì°¸ê³ ì‚¬í•­</b><br/>
          <div style="margin-left:10px;">
            1) ì„ íƒí•œ ${tierLabel} ê¸°ì¤€: 13ì–µëª… í›„ë³´ì AIí‰ê°€ ë° ì¶”ì²œ <b>${nfmt(cap)}ëª…</b><br/>
            2) ì±„ìš©ê³µê³  ì§€ì›ì ì¤‘ AIí‰ê°€ <b>${nfmt(app)}ëª…</b>
          </div>
        </div>
      `;
    }

    function renderCaptureHtml({ total, rows, quoteNo, aiTier }){
      const company = ($('company').value || '').trim();
      const contact = ($('contact').value || '').trim();
      const email = ($('email').value || '').trim();
      const quoteDate = $('quoteDate').value || new Date().toISOString().slice(0,10);
      const validUntil = $('validUntil').value || addDaysISO(quoteDate, 20);

      // ê¸ˆì•¡ ê¸€ì”¨ ì¡°ê¸ˆ ë” í¬ê²Œ(PDF)
      const bodyRows = rows.map(r => {
        const unit = (r.unit == null) ? 'ë¬¸ì˜' : money(r.unit);
        const qty = (r.qty == null) ? '-' : String(r.qty);
        const amt = (r.amount == null) ? 'ë¬¸ì˜' : `${money(r.amount)} /ì—°ê°„`;

        // ê¸ˆì•¡(ì˜ë¬¸/ìˆ«ì)ì€ Arial
        const amtHtml = (r.amount == null) ? 'ë¬¸ì˜' : `<span class="pdf-en" style="font-size:12px;font-weight:900;">${money(r.amount)}</span> <span class="pdf-ko" style="font-size:10px;">/ì—°ê°„</span>`;

        return `
          <tr>
            <td class="pdf-ko" style="padding:7px;font-size:10.2px;font-weight:700;color:#000;border-top:1px solid #000;border-bottom:1px solid #000;">${r.name}</td>
            <td class="pdf-en" style="padding:7px;font-size:10.2px;color:#000;text-align:right;border-top:1px solid #000;border-bottom:1px solid #000;">${unit}</td>
            <td class="pdf-en" style="padding:7px;font-size:10.2px;color:#000;text-align:right;border-top:1px solid #000;border-bottom:1px solid #000;">${qty}</td>
            <td style="padding:7px;text-align:right;border-top:1px solid #000;border-bottom:1px solid #000;">
              ${r.amount == null ? `<span class="pdf-ko" style="font-size:11px;font-weight:900;color:#000;">ë¬¸ì˜</span>` : amtHtml}
            </td>
          </tr>
        `;
      }).join('');

      return `
        <div style="color:#000;">
          <div class="pdf-en" style="font-size:30px;font-weight:900;margin:0 0 22px;letter-spacing:-.2px;">
            Linkedin Solution ê²¬ì ì„œ
          </div>

          <div style="height:14px"></div>

          <div style="border:1.25px solid #000;">
            <table style="width:100%;border-collapse:collapse;table-layout:fixed;">
              <tbody>
                <tr>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;width:18%;border-right:1px solid #000;border-bottom:1px solid #000;">ê²¬ì ë²ˆí˜¸</th>
                  <td class="pdf-en" style="padding:8px;font-size:11px;color:#000;width:32%;border-right:1px solid #000;border-bottom:1px solid #000;">${quoteNo}</td>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;width:18%;border-right:1px solid #000;border-bottom:1px solid #000;">ê²¬ì ì¼</th>
                  <td class="pdf-en" style="padding:8px;font-size:11px;color:#000;width:32%;border-bottom:1px solid #000;">${quoteDate}</td>
                </tr>
                <tr>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;border-right:1px solid #000;border-bottom:1px solid #000;">ìœ íš¨ê¸°ê°„</th>
                  <td class="pdf-en" style="padding:8px;font-size:11px;color:#000;border-right:1px solid #000;border-bottom:1px solid #000;">${validUntil} (20ì¼)</td>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;border-right:1px solid #000;border-bottom:1px solid #000;">VAT</th>
                  <td class="pdf-ko" style="padding:8px;font-size:11px;color:#000;border-bottom:1px solid #000;">í•´ë‹¹ì—†ìŒ</td>
                </tr>
                <tr>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;border-right:1px solid #000;border-bottom:1px solid #000;">íšŒì‚¬ëª…</th>
                  <td class="pdf-ko" style="padding:8px;font-size:11px;color:#000;border-right:1px solid #000;border-bottom:1px solid #000;">${company || '-'}</td>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;border-right:1px solid #000;border-bottom:1px solid #000;">ë‹´ë‹¹ì</th>
                  <td class="pdf-ko" style="padding:8px;font-size:11px;color:#000;border-bottom:1px solid #000;">${contact || '-'}</td>
                </tr>
                <tr>
                  <th class="pdf-ko" style="background:#f3f4f6;padding:8px;font-size:11px;font-weight:900;color:#000;text-align:center;border-right:1px solid #000;">ì´ë©”ì¼</th>
                  <td class="pdf-en" colspan="3" style="padding:8px;font-size:11px;color:#000;">${email || '-'}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div style="height:18px"></div>

          <div style="border:1.25px solid #000;">
            <table style="width:100%;border-collapse:collapse;table-layout:fixed;">
              <thead>
                <tr>
                  <th class="pdf-ko" style="padding:8px;background:#e5e7eb;width:45%;text-align:center;font-size:11px;font-weight:900;color:#000;border-bottom:1px solid #000;">í•­ëª©</th>
                  <th class="pdf-ko" style="padding:8px;background:#e5e7eb;width:18%;text-align:center;font-size:11px;font-weight:900;color:#000;border-bottom:1px solid #000;">ë‹¨ê°€(USD)</th>
                  <th class="pdf-ko" style="padding:8px;background:#e5e7eb;width:10%;text-align:center;font-size:11px;font-weight:900;color:#000;border-bottom:1px solid #000;">ìˆ˜ëŸ‰</th>
                  <th class="pdf-ko" style="padding:8px;background:#e5e7eb;width:27%;text-align:center;font-size:11px;font-weight:900;color:#000;border-bottom:1px solid #000;">ê¸ˆì•¡(USD)</th>
                </tr>
              </thead>
              <tbody>
                ${bodyRows || `<tr><td colspan="4" class="pdf-ko" style="padding:8px;font-size:11px;color:#000;border-top:1px solid #000;">ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`}
              </tbody>
            </table>
          </div>

          <!-- âœ… Total ê¸ˆì•¡ í¬ê²Œ + ì•„ë˜ì— ì—°ê°„ê¸ˆì•¡(vatì—†ìŒ) -->
          <div style="margin-top:10px;text-align:right;">
            <div class="pdf-en" style="font-size:20px;font-weight:900;color:#000;">
              Total (USD) : ${money(total)}
            </div>
            <div class="pdf-ko" style="margin-top:4px;font-size:11px;color:#000;">
              ì—°ê°„ê¸ˆì•¡(vatì—†ìŒ)
            </div>
          </div>

          ${tierNoteHtml(aiTier)}

          <!-- âœ… Partner ì˜ì—­ì„ "ì™„ì „ ì•„ë˜"ë¡œ: ìŠ¤í˜ì´ì„œë¥¼ ë” í¬ê²Œ -->
          <div style="height:230px"></div>

          <div style="text-align:center;">
            <div class="pdf-en" style="font-size:18px;font-weight:900;color:#000;">Linkedin Korea Partner</div>
            <div class="pdf-en" style="margin-top:6px;font-size:11px;color:#000;">02-6405-4446 / help@hrpoint.co.kr</div>

            <div class="pdf-ko" style="margin-top:28px;font-size:11px;color:#000;">
              ë³¸ ê²¬ì ì„œëŠ” ë‹¨ìˆœ ì°¸ê³ ìš©ì…ë‹ˆë‹¤.
            </div>
          </div>
        </div>
      `;
    }

    async function makePdfByCapture(){
      setDefaultQuoteFields();
      const { total, rows, aiTier, quoteNo } = recalc();
      if (!rows.length) { toast('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }

      const root = $('pdfCaptureRoot');
      root.innerHTML = renderCaptureHtml({ total, rows, quoteNo, aiTier });

      const canvas = await html2canvas(root, {
        scale: 2,
        backgroundColor: "#ffffff",
        useCORS: true,
        allowTaint: true
      });

      const imgData = canvas.toDataURL('image/png');

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ unit:'pt', format:'a4' });

      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();

      const imgW = pageW;
      const imgH = canvas.height * (imgW / canvas.width);

      let remaining = imgH;

      pdf.addImage(imgData, 'PNG', 0, 0, imgW, imgH, undefined, 'FAST');
      remaining -= pageH;

      while (remaining > 0) {
        pdf.addPage();
        const y = -(imgH - remaining);
        pdf.addImage(imgData, 'PNG', 0, y, imgW, imgH, undefined, 'FAST');
        remaining -= pageH;
      }

      const filename = `Linkedin ì†”ë£¨ì…˜ ê²¬ì ì„œ_${fileStamp()}.pdf`;
      pdf.save(filename);
    }

    async function logOnceForCurrentQuote(){
      setDefaultQuoteFields();
      const { total, rows, aiTier } = recalc();
      if (!rows.length) return false;
      await saveToSheetOnce(buildSheetPayload(total, rows, aiTier));
      return true;
    }

    async function onDownloadPdf(){
      if (!validateRequired()) return;
      const ok = await logOnceForCurrentQuote();
      if (!ok) { toast('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
      await makePdfByCapture();
    }

    async function onCopyLink(){
      const ok = await logOnceForCurrentQuote();
      if (!ok) { toast('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }

      const p = new URLSearchParams({
        company: $('company').value || '',
        contact: $('contact').value || '',
        email: $('email').value || '',
        quoteNo: $('quoteNo').value || '',
        quoteDate: $('quoteDate').value || '',
        qtyRecruiter: $('qtyRecruiter').value || '0',
        qtyJob: $('qtyJob').value || '0',
        aiTier: $('aiTier').value || 'none',
        lifeInclude: $('lifeInclude').value || 'no',
        qtyLTI: $('qtyLTI').value || '0'
      });

      const url = `${location.origin}${location.pathname}?${p.toString()}`;
      try { await navigator.clipboard.writeText(url); toast('ê²¬ì ì„œ ê²°ê³¼ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
      catch(e){ toast('ë³µì‚¬ ì‹¤íŒ¨'); }
    }

    function applyStateFromLink(){
      const p = new URLSearchParams(location.search);
      const set = (id, key) => { if (p.has(key) && $(id)) $(id).value = p.get(key); };
      set('company','company');
      set('contact','contact');
      set('email','email');
      set('qtyRecruiter','qtyRecruiter');
      set('qtyJob','qtyJob');
      set('aiTier','aiTier');
      set('lifeInclude','lifeInclude');
      set('qtyLTI','qtyLTI');
      if (p.has('quoteNo') && $('quoteNo')) $('quoteNo').value = p.get('quoteNo');
    }

    function resetAll(){
      $('company').value='';
      $('contact').value='';
      $('email').value='';
      $('qtyRecruiter').value='0';
      $('qtyJob').value='0';
      $('aiTier').value='none';
      $('lifeInclude').value='no';
      $('qtyLTI').value='0';

      history.replaceState({}, '', location.pathname);

      localStorage.removeItem('lk_quote_sig');
      localStorage.removeItem('lk_quote_no');

      setDefaultQuoteFields();
      recalc();
      toast('ì´ˆê¸°í™” ì™„ë£Œ');
    }

    document.getElementById('btnPdf')?.addEventListener('click', async (e)=>{ e.preventDefault(); await onDownloadPdf(); });
    document.getElementById('btnCopyLink')?.addEventListener('click', async (e)=>{ e.preventDefault(); await onCopyLink(); });
    document.getElementById('btnReset')?.addEventListener('click', (e)=>{ e.preventDefault(); resetAll(); });

    ['company','contact','email','qtyRecruiter','qtyJob','aiTier','lifeInclude','qtyLTI'].forEach(id=>{
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', ()=>{ setDefaultQuoteFields(); recalc(); });
      el.addEventListener('change', ()=>{ setDefaultQuoteFields(); recalc(); });
    });

    applyStateFromLink();
    setDefaultQuoteFields();
    recalc();
  </script>
</body>
</html>
