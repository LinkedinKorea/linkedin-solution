<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LinkedIn 기업용 솔루션 자동 견적서</title>
  <style>
    :root{--bg:#0b0f14;--card:#111827;--muted:#9ca3af;--text:#e5e7eb;--accent:#60a5fa;--line:#1f2937;--soft:#ffffff12}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial;background:linear-gradient(180deg,#070a0f,#0b0f14 40%);color:var(--text)}
    .wrap{max-width:1240px;margin:0 auto;padding:28px 18px 120px}
    .top{display:flex;gap:12px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
    h1{margin:0;font-size:22px;letter-spacing:-.2px}
    .sub{margin:8px 0 0;color:var(--muted);line-height:1.55;font-size:13px}
    .pill{display:inline-flex;gap:8px;align-items:center;background:rgba(96,165,250,.12);border:1px solid rgba(96,165,250,.25);color:#cfe6ff;padding:8px 10px;border-radius:999px;font-size:12px}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{background:rgba(17,24,39,.72);border:1px solid var(--line);border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.25);overflow:hidden}
    .hd{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .hd b{font-size:14px}
    .bd{padding:16px}

    label{display:block;font-size:12px;color:#cbd5e1;margin-bottom:6px}
    input, select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#0b1220;color:var(--text);outline:none}
    input:focus, select:focus{border-color:rgba(96,165,250,.6);box-shadow:0 0 0 3px rgba(96,165,250,.14)}
    input[readonly]{opacity:.95}

    .rows{display:grid;gap:22px}
    .row{display:grid;grid-template-columns:1fr 240px 220px;gap:14px;align-items:center;padding:14px 0;border-bottom:1px solid rgba(31,41,55,.55)}
    .row:last-child{border-bottom:none}
    @media (max-width:720px){.row{grid-template-columns:1fr}}

    .muted{color:var(--muted);font-size:12px;line-height:1.55}
    .descBox{margin-top:10px;background:var(--soft);border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:12px;color:#cbd5e1;font-size:12px;line-height:1.55;white-space:pre-line}
    .solTitle{font-weight:900;letter-spacing:-.2px;font-size:13px;color:#f3f4f6}

    .rowMeta{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;align-items:end;padding:12px 0 18px;border-bottom:1px solid rgba(31,41,55,.55)}
    .rowMeta2{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:end;padding:16px 0 6px;border-bottom:1px solid rgba(31,41,55,.55)}
    @media (max-width:720px){.rowMeta{grid-template-columns:1fr}.rowMeta2{grid-template-columns:1fr}}

    .readonlyDim{background:rgba(255,255,255,.06)!important;border-color:rgba(255,255,255,.10)!important;color:rgba(229,231,235,.78)!important;box-shadow:none!important}
    .labelDim{color:rgba(203,213,225,.65)!important}

    .aiBox{border:1px solid rgba(96,165,250,.22);background:rgba(96,165,250,.10);border-radius:16px;padding:12px 12px}
    .aiHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .aiBadge{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid rgba(96,165,250,.22);background:rgba(96,165,250,.10);color:rgba(219,234,254,.95);font-size:12px;font-weight:900}
    .aiBadge .dot{width:8px;height:8px;border-radius:999px;background:rgba(96,165,250,.95);box-shadow:0 0 0 3px rgba(96,165,250,.18)}
    .aiReq{color:rgba(219,234,254,.85);font-size:12px;font-weight:800;letter-spacing:-.1px}
    .aiGrid{display:grid;grid-template-columns:1fr 220px 220px;gap:14px;align-items:end}
    @media (max-width:720px){.aiGrid{grid-template-columns:1fr}}
    .aiSmall{font-size:11px;line-height:1.35;white-space:pre-line}

    #aiTier{padding-right:34px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}

    table{width:100%;border-collapse:separate;border-spacing:0}
    th, td{padding:10px 10px;border-bottom:1px solid var(--line);vertical-align:top}
    th{font-size:12px;color:#cbd5e1;text-align:left;background:rgba(11,18,32,.35)}
    td{font-size:13px}
    .right{text-align:right}

    .kpis{display:grid;gap:10px}
    .kpi{padding:12px;border:1px solid var(--line);border-radius:14px;background:rgba(11,18,32,.55)}
    .kpi .t{font-size:12px;color:var(--muted)}
    .kpi .v{font-size:20px;font-weight:900;margin-top:6px;letter-spacing:-.2px}

    .callout{margin-top:14px;padding:10px 12px;border-radius:14px;border:1px solid rgba(96,165,250,.25);background:rgba(96,165,250,.08);color:#dbeafe;font-size:12px;line-height:1.55}

    .sticky{position:fixed;left:0;right:0;bottom:0;padding:14px 14px;background:rgba(8,12,18,.72);backdrop-filter:blur(10px);border-top:1px solid var(--line)}
    .sticky .inner{max-width:1240px;margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;border:1px solid var(--line);background:#0b1220;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800;font-size:13px}
    button.primary{border-color:rgba(96,165,250,.45);background:rgba(96,165,250,.14)}
    button:hover{filter:brightness(1.07)}

    .toast{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);background:rgba(17,24,39,.92);border:1px solid var(--line);padding:10px 12px;border-radius:12px;box-shadow:0 12px 24px rgba(0,0,0,.35);font-size:13px;display:none;z-index:9999}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>LinkedIn 기업용 솔루션 자동 견적서</h1>
        <div class="sub">
          고객이 직접 수량을 입력해 <b>USD 기준 견적</b>을 계산하고, 맨 하단 버튼으로 <b>견적서(PDF)</b>를 다운로드할 수 있습니다.
          <br/>※ 표기 금액은 단가 기준이며, 실제 계약/조건에 따라 달라질 수 있습니다. <b>매년 7월 1일부터 금액이 인상됩니다.</b>
        </div>
      </div>
      <div class="pill">부가세 없음 · USD 기준</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="hd"><b>기업 솔루션 선택</b><span class="muted">PDF에 함께 출력됩니다</span></div>
        <div class="bd">

          <div class="rowMeta">
            <div>
              <label for="companyName">회사명</label>
              <input id="companyName" placeholder="예) Samsung" />
            </div>
            <div>
              <label for="contactName">담당자</label>
              <input id="contactName" placeholder="예) 홍길동" />
            </div>
            <div>
              <label for="contactEmail">이메일</label>
              <input id="contactEmail" placeholder="예) name@company.com" />
            </div>
          </div>

          <div class="rowMeta2">
            <div>
              <label for="quoteNoInput">견적번호</label>
              <input id="quoteNoInput" class="mono" readonly />
            </div>
            <div>
              <label>통화</label>
              <input value="USD (VAT 없음)" readonly />
            </div>
          </div>

          <div class="rows">
            <div class="row">
              <div>
                <div class="solTitle">Recruiter (인재검색)</div>
                <div class="descBox">• 13억+ 가입자 풀에서 후보자를 검색합니다.
• 인맥 여부와 관계없이 메시지(InMail) 발송이 가능합니다.</div>
              </div>
              <div>
                <label for="qtyRecruiter">수량(라이선스)</label>
                <select id="qtyRecruiter">
                  <option value="0" selected>선택 안 함</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>금액</label>
                <input id="amtRecruiter" readonly />
              </div>
            </div>

            <div class="row">
              <div>
                <div class="solTitle">Job Slot (채용공고)</div>
                <div class="descBox">• 직무별 채용공고를 게시하고 후보자를 지속적으로 모집합니다.
• 지원자 파이프라인을 운영하며 공고 성과를 관리합니다.</div>
              </div>
              <div>
                <label for="qtyJob">수량(슬롯)</label>
                <select id="qtyJob">
                  <option value="0" selected>선택 안 함</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>금액</label>
                <input id="amtJob" readonly />
              </div>
            </div>

            <div class="row">
              <div>
                <div class="solTitle">AI Hiring Assistant (Recruiter 옵션)</div>
                <div class="descBox">• JD 업로드 후 후보자를 AI로 평가/추천합니다.
• 채용담당자의 초기 검토 시간을 줄여 효율을 높입니다.</div>
              </div>
              <div>
                <label for="aiTier">Tier</label>
                <select id="aiTier">
                  <option value="none" selected>선택 안 함</option>
                  <option value="t1">Tier 1 — $3,170 (후보자 200명)</option>
                  <option value="t2">Tier 2 — $6,910 (후보자 800명)</option>
                  <option value="t3">Tier 3 — $10,365 (후보자 1,500명)</option>
                </select>
              </div>
              <div>
                <label>금액</label>
                <input id="amtAI" readonly />
              </div>
            </div>

            <div class="aiBox">
              <div class="aiHead">
                <div class="aiBadge"><span class="dot"></span>AI Assistant 참고사항</div>
                <div class="aiReq">Recruiter 계약필수</div>
              </div>

              <div class="aiGrid">
                <div class="muted">※ AI Hiring Assistant는 Recruiter 솔루션 옵션입니다.</div>

                <div>
                  <label class="labelDim">13억 가입자 중 AI검색 및 추천</label>
                  <input id="aiSearchCap" class="readonlyDim aiSmall" readonly />
                </div>

                <div>
                  <label class="labelDim">채용공고 지원자 중 AI평가 및 추천</label>
                  <input id="aiApplicantCap" class="readonlyDim aiSmall" readonly />
                </div>
              </div>
            </div>

            <div class="row">
              <div>
                <div class="solTitle">Life Page (기업브랜딩/광고)</div>
                <div class="descBox">• 기업규모에 따른 가격 상이
• 문의 필수</div>
              </div>
              <div>
                <label for="lifeInclude">포함 여부</label>
                <select id="lifeInclude">
                  <option value="no" selected>미포함</option>
                  <option value="yes">포함(금액: 문의)</option>
                </select>
              </div>
              <div>
                <label>금액</label>
                <input id="amtLife" readonly />
              </div>
            </div>

            <div class="row">
              <div>
                <div class="solTitle">LTI (경쟁사 분석)</div>
                <div class="descBox">• 경쟁사의 인력현황 및 역량을 분석합니다.
• 인재 전략 수립을 위한 인사이트를 제공합니다.</div>
              </div>
              <div>
                <label for="qtyLTI">수량(라이선스)</label>
                <select id="qtyLTI">
                  <option value="0" selected>선택 안 함</option>
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                  <option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                </select>
              </div>
              <div>
                <label>금액</label>
                <input id="amtLTI" readonly />
              </div>
            </div>
          </div>

          <div class="callout">
            <b>문의 안내</b><br/>
            • 견적서 유효기간 내 <b>Linkedin Korea Partner</b>로 문의 부탁드립니다.<br/>
            • 전화 : <b>02-6405-4446</b> / E-mail : <b>help@hrpoint.co.kr</b><br/>
            • Life Page는 기업 규모에 따라 금액이 상이. <b>문의필수</b>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><b>요약</b><span class="muted">USD 기준</span></div>
        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <div class="t">총 합계</div>
              <div class="v" id="total">-</div>
              <div class="muted">※ 부가세 없음</div>
            </div>
            <div class="kpi">
              <div class="t">선택 항목</div>
              <div class="v" id="items">-</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <table>
            <thead>
              <tr>
                <th>항목</th>
                <th class="right">단가(USD)</th>
                <th class="right">수량</th>
                <th class="right">금액(USD)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
            <tfoot>
              <tr>
                <th colspan="3" class="right">합계</th>
                <th class="right" id="total2">-</th>
              </tr>
            </tfoot>
          </table>

          <div class="foot" style="margin-top:12px">
            <div class="callout" style="margin-top:0;border-color:rgba(52,211,153,.35);background:rgba(52,211,153,.10);color:#d1fae5">
              <b>기업용 솔루션 문의</b><br/>
              LinkedIn Korea Partner<br/>
              전화 : 02-6405-4446<br/>
              E-mail : help@hrpoint.co.kr<br/>
              <div style="margin-top:8px;font-size:11px;line-height:1.45;opacity:.95">
                할인적용대상 : 그룹사 할인, 볼륨할인, 다년계약 할인 적용가능
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="toast" id="toast">완료</div>
  </div>

  <div class="sticky">
    <div class="inner">
      <div class="muted">버튼을 누르면 입력값 기준으로 견적서(PDF)가 다운로드됩니다. (USD 기준 · 부가세 없음)</div>
      <div class="btns">
        <button id="btnCopyLink">입력값 링크 복사</button>
        <button id="btnReset">초기화</button>
        <button class="primary" id="btnPdf">견적서 다운로드(PDF)</button>
      </div>
    </div>
  </div>

  <div id="pdfRender" style="position:fixed; left:-99999px; top:0; width:794px; background:#ffffff; color:#111827; padding:28px; font-family:'Noto Sans KR', Apple SD Gothic Neo, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;"></div>

  <script>
    // ====== 설정 ======
    const FOOTER_TEXT = "Linkedin Korea Partner_HR Point";
    const SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyxGaw4fsp38N0cLZBud8BYiyESZv4IUyt0CKn5D-2ayWA7yJzN4zvsz2iGiyK2oSS6/exec";
    const DEBUG_SHEET_LOG = true; // 저장 요청 URL을 콘솔에 찍습니다.

    const PRICES = {
      recruiter: 11350,
      job: 2010,
      lti: 12500,
      ai: {
        none: { price: 0, search: 0, app: 0, label: '선택 안 함' },
        t1: { price: 3170,  search: 200,  app: 3500,  label: 'Tier 1' },
        t2: { price: 6910,  search: 800,  app: 9000,  label: 'Tier 2' },
        t3: { price: 10365, search: 1500, app: 25000, label: 'Tier 3' },
      }
    };

    // ====== 헬퍼 ======
    const $ = (id) => document.getElementById(id) || { value:'', textContent:'', innerHTML:'', style:{}, addEventListener:()=>{} };
    const nfmt = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(Math.round(n || 0));
    const money = (n) => `$${nfmt(n)}`;
    const toNum = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/[,\s]/g,'').trim();
      if (!s) return 0;
      const x = Number(s);
      return isFinite(x) ? x : 0;
    };
    const toast = (msg='완료') => {
      const t = $('toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>{t.style.display='none';}, 1800);
    };

    const yyyymmdd = (d=new Date()) => {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}${m}${day}`;
    };
    const genQuoteNo = () => {
      const rnd = Math.random().toString(16).slice(2,6).toUpperCase();
      return `${yyyymmdd()}-LK-${rnd}`;
    };
    function ensureQuoteNoOnce() {
      const KEY = "lk_quote_no_v1";
      const fromUrl = new URLSearchParams(location.search).get("quoteNo");
      const saved = sessionStorage.getItem(KEY);
      const quoteNo = (fromUrl && fromUrl.trim()) ? fromUrl.trim() : (saved && saved.trim()) ? saved.trim() : genQuoteNo();
      sessionStorage.setItem(KEY, quoteNo);
      const el = document.getElementById("quoteNoInput");
      if (el) el.value = quoteNo;
      return quoteNo;
    }
    const addDaysISO = (isoDate, days) => {
      if (!isoDate) return '';
      const d = new Date(isoDate + 'T00:00:00');
      d.setDate(d.getDate() + days);
      return d.toISOString().slice(0,10);
    };

    function pad2(n){ return String(n).padStart(2,'0'); }
    function downloadStamp(){
      const d = new Date();
      return `${d.getFullYear()}${pad2(d.getMonth()+1)}${pad2(d.getDate())}_${pad2(d.getHours())}${pad2(d.getMinutes())}`;
    }

    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
        .replaceAll('"','&quot;').replaceAll("'","&#039;");
    }

    function buildRows(state){
      const rows = [];
      if (state.qtyRecruiter > 0) rows.push({ key:'Recruiter', name:'Recruiter (인재검색)', unit:PRICES.recruiter, qty:state.qtyRecruiter, amount:state.amtRecruiter });
      if (state.qtyJob > 0) rows.push({ key:'Job Slot', name:'Job Slot (채용공고)', unit:PRICES.job, qty:state.qtyJob, amount:state.amtJob });
      if (state.aiTier !== 'none') rows.push({ key:'AI Hiring Assistant', name:`AI Hiring Assistant (${PRICES.ai[state.aiTier].label})`, unit:PRICES.ai[state.aiTier].price, qty:1, amount:state.amtAI, tier: state.aiTier });
      if (state.lifeInclude === 'yes') rows.push({ key:'Life Page', name:'Life Page (기업브랜딩/광고) — 문의 필수', unit:null, qty:null, amount:null });
      if (state.qtyLTI > 0) rows.push({ key:'LTI', name:'LTI (경쟁사 분석)', unit:PRICES.lti, qty:state.qtyLTI, amount:state.amtLTI });
      return rows;
    }

    function selectionSummary(rows){
      return rows.map(r => {
        if (r.key === 'AI Hiring Assistant') return `AI(${r.tier || ''}) x1`;
        if (r.qty == null) return `${r.key}`;
        return `${r.key} x${r.qty}`;
      }).join('; ');
    }

    function updateAiNotes(aiTier){
      const sEl = document.getElementById('aiSearchCap');
      const aEl = document.getElementById('aiApplicantCap');
      const t = PRICES.ai[aiTier] || PRICES.ai.none;
      if (!sEl || !aEl) return;
      if (aiTier === 'none') { sEl.value = '-'; aEl.value = '-'; return; }
      sEl.value = `13억 가입자 중\nAI검색 및 추천 ${nfmt(t.search)}명`;
      aEl.value = `채용공고 지원자 중\n${nfmt(t.app)}명 추천`;
    }

    function recalc(){
      const aiTier = $('aiTier').value;
      const qtyRecruiter = toNum($('qtyRecruiter').value);
      const qtyJob = toNum($('qtyJob').value);
      const qtyLTI = toNum($('qtyLTI').value);
      const lifeInclude = $('lifeInclude').value;

      const amtRecruiter = qtyRecruiter * PRICES.recruiter;
      const amtJob = qtyJob * PRICES.job;
      const amtAI = (PRICES.ai[aiTier]?.price || 0);
      const amtLTI = qtyLTI * PRICES.lti;

      const total = amtRecruiter + amtAI + amtJob + amtLTI;

      $('amtRecruiter').value = money(amtRecruiter);
      $('amtAI').value = money(amtAI);
      $('amtJob').value = money(amtJob);
      $('amtLTI').value = money(amtLTI);
      $('amtLife').value = lifeInclude === 'yes' ? '문의 필수' : '-';

      updateAiNotes(aiTier);

      $('total').textContent = money(total);
      $('total2').textContent = money(total);

      const rows = buildRows({ aiTier, qtyRecruiter, qtyJob, qtyLTI, lifeInclude, amtRecruiter, amtAI, amtJob, amtLTI, total });
      $('items').textContent = rows.length ? `${rows.length}개 항목` : '-';

      const tb = $('tbody');
      tb.innerHTML = rows.length ? rows.map(r => {
        const unit = (r.unit == null) ? '문의' : money(r.unit);
        const qty = (r.qty == null) ? '-' : nfmt(r.qty);
        const amt = (r.amount == null) ? '문의' : money(r.amount);
        return `<tr><td>${r.name}</td><td class="right">${unit}</td><td class="right">${qty}</td><td class="right">${amt}</td></tr>`;
      }).join('') : `<tr><td colspan="4" class="muted">선택된 항목이 없습니다. 수량/티어를 선택해 주세요.</td></tr>`;

      return { total, rows, aiTier };
    }

    function buildPdfHtml({ quoteNo, quoteDate, validUntil, companyName, contactName, contactEmail, rows, total, aiTier }){
      const ai = PRICES.ai[aiTier] || PRICES.ai.none;

      const rowsHtml = rows.map(r => {
        const unit = (r.unit == null) ? '문의' : money(r.unit);
        const qty  = (r.qty == null) ? '-' : nfmt(r.qty);
        const amt  = (r.amount == null) ? '문의' : money(r.amount);
        return `
          <tr>
            <td style="padding:10px 8px;border-bottom:1px solid #e5e7eb;">${escapeHtml(r.name)}</td>
            <td style="padding:10px 8px;border-bottom:1px solid #e5e7eb;text-align:right;white-space:nowrap;">${escapeHtml(unit)}</td>
            <td style="padding:10px 8px;border-bottom:1px solid #e5e7eb;text-align:right;white-space:nowrap;">${escapeHtml(qty)}</td>
            <td style="padding:10px 8px;border-bottom:1px solid #e5e7eb;text-align:right;white-space:nowrap;">${escapeHtml(amt)}</td>
          </tr>
        `;
      }).join('');

      const aiBlock = (aiTier === 'none') ? '' : `
        <div style="margin-top:14px;padding:12px 12px;border:1px solid #bfdbfe;background:#eff6ff;border-radius:12px;">
          <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;">
            <div style="font-weight:900;color:#1d4ed8;">AI Assistant 참고사항</div>
            <div style="font-weight:800;color:#1e40af;">Recruiter 계약필수</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:#1f2937;line-height:1.4;">
            • 13억 가입자 중 AI검색 및 추천 ${nfmt(ai.search)}명<br/>
            • 채용공고 지원자 중 ${nfmt(ai.app)}명 추천
          </div>
        </div>
      `;

      return `
        <div style="font-size:28px;font-weight:900;letter-spacing:-.3px;line-height:1.1;">
          견적서 (LinkedIn Solutions)
        </div>

        <div style="display:flex;justify-content:space-between;gap:12px;margin-top:12px;font-size:12px;color:#111827;">
          <div>
            <div><b>견적번호</b>: ${escapeHtml(quoteNo)}</div>
            <div style="margin-top:4px;"><b>유효기간</b>: ${escapeHtml(validUntil)} (20일)</div>
            <div style="margin-top:4px;"><b>회사명</b>: ${escapeHtml(companyName)}</div>
            <div style="margin-top:4px;"><b>담당자</b>: ${escapeHtml(contactName)}</div>
            <div style="margin-top:4px;"><b>이메일</b>: ${escapeHtml(contactEmail)}</div>
          </div>
          <div style="text-align:right;">
            <div><b>견적일자</b>: ${escapeHtml(quoteDate)}</div>
            <div style="margin-top:4px;"><b>VAT</b>: 없음</div>
            <div style="margin-top:4px;"><b>Currency</b>: USD</div>
          </div>
        </div>

        <div style="margin-top:16px;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden;">
          <table style="width:100%;border-collapse:collapse;font-size:12px;">
            <thead>
              <tr style="background:#111827;color:#ffffff;">
                <th style="padding:10px 8px;text-align:left;">항목</th>
                <th style="padding:10px 8px;text-align:right;">단가(USD)</th>
                <th style="padding:10px 8px;text-align:right;">수량</th>
                <th style="padding:10px 8px;text-align:right;">금액(USD)</th>
              </tr>
            </thead>
            <tbody>${rowsHtml}</tbody>
            <tfoot>
              <tr>
                <td colspan="3" style="padding:10px 8px;text-align:right;font-weight:900;border-top:1px solid #e5e7eb;">합계</td>
                <td style="padding:10px 8px;text-align:right;font-weight:900;border-top:1px solid #e5e7eb;">${escapeHtml(money(total))}</td>
              </tr>
            </tfoot>
          </table>
        </div>

        ${aiBlock}

        <div style="margin-top:14px;font-size:11px;color:#111827;line-height:1.55;">
          • 견적서 유효기간 내 Linkedin Korea Partner로 문의 부탁드립니다.<br/>
          • 전화 : 02-6405-4446 / E-mail : help@hrpoint.co.kr<br/>
          • Life Page는 기업 규모에 따라 금액이 상이합니다. (문의필수)<br/>
          <div style="margin-top:8px;">
            할인적용대상 : 그룹사 할인, 볼륨할인, 다년계약 할인 적용가능
          </div>
        </div>
      `;
    }

    // ✅ 시트 저장: sendBeacon(가능하면) → 이미지 비콘 fallback
    async function saveToSheet(payload){
      const params = new URLSearchParams();
      params.set('savedAt', payload.savedAt || new Date().toISOString());
      params.set('quoteNo', payload.quoteNo || '');
      params.set('companyName', payload.companyName || '');
      params.set('contactName', payload.contactName || '');
      params.set('contactEmail', payload.contactEmail || '');
      params.set('currency', payload.currency || 'USD');
      params.set('totalUSD', String(payload.totalUSD ?? ''));
      params.set('selectedCount', String(payload.selectedCount ?? ''));
      params.set('selectedSummary', payload.selectedSummary || '');
      params.set('aiTier', payload.aiTier || '');
      params.set('userAgent', navigator.userAgent || '');
      params.set('pageUrl', location.href || '');
      params.set('_ts', String(Date.now())); // cache buster

      const url = `${SHEET_WEBAPP_URL}?${params.toString()}`;

      if (DEBUG_SHEET_LOG) console.log('[SHEET] sending:', url);

      // 1) sendBeacon 시도 (응답은 못 받지만 전송 성공률 높음)
      try{
        if (navigator.sendBeacon) {
          const ok = navigator.sendBeacon(url, new Blob([], {type:'text/plain'}));
          if (DEBUG_SHEET_LOG) console.log('[SHEET] sendBeacon result:', ok);
          // sendBeacon이 false여도 fallback 진행
          if (ok) return true;
        }
      }catch(e){}

      // 2) 이미지 비콘 fallback
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(true); // GAS는 JSON 반환이라 error여도 요청은 나감
        img.src = url;
        setTimeout(() => resolve(true), 2000);
      });
    }

    async function makePdf(){
      const { total, rows, aiTier } = recalc();
      if (!rows.length) { toast('수량/티어를 선택해 주세요.'); return; }

      const quoteNo = $('quoteNoInput').value || ensureQuoteNoOnce();
      const quoteDate = new Date().toISOString().slice(0,10);
      const validUntil = addDaysISO(quoteDate, 20);

      const companyName  = $('companyName').value?.trim() || '-';
      const contactName  = $('contactName').value?.trim() || '-';
      const contactEmail = $('contactEmail').value?.trim() || '-';

      // 1) 시트 저장(먼저)
      await saveToSheet({
        savedAt: new Date().toISOString(),
        quoteNo, companyName, contactName, contactEmail,
        currency: 'USD',
        totalUSD: Math.round(total || 0),
        selectedCount: rows.length,
        selectedSummary: selectionSummary(rows),
        aiTier
      });

      // 2) PDF 생성(캡처)
      const pdfEl = document.getElementById('pdfRender');
      pdfEl.innerHTML = buildPdfHtml({ quoteNo, quoteDate, validUntil, companyName, contactName, contactEmail, rows, total, aiTier });

      const canvas = await html2canvas(pdfEl, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
      const imgData = canvas.toDataURL('image/png');

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });

      const pageWidth = doc.internal.pageSize.getWidth();
      const pageHeight = doc.internal.pageSize.getHeight();
      const margin = 24;

      const targetW = pageWidth - margin * 2;
      const targetH = (canvas.height * targetW) / canvas.width;

      if (targetH <= pageHeight - margin * 2) {
        doc.addImage(imgData, 'PNG', margin, margin, targetW, targetH);
      } else {
        const pageContentH = pageHeight - margin * 2;
        const ratio = canvas.width / targetW;
        const sliceHpx = Math.floor(pageContentH * ratio);

        let y = 0;
        let page = 0;

        while (y < canvas.height) {
          const sliceCanvas = document.createElement('canvas');
          sliceCanvas.width = canvas.width;
          sliceCanvas.height = Math.min(sliceHpx, canvas.height - y);

          const ctx = sliceCanvas.getContext('2d');
          ctx.drawImage(canvas, 0, y, canvas.width, sliceCanvas.height, 0, 0, canvas.width, sliceCanvas.height);

          const sliceData = sliceCanvas.toDataURL('image/png');
          const sliceHpt = (sliceCanvas.height * targetW) / sliceCanvas.width;

          if (page > 0) doc.addPage();
          doc.addImage(sliceData, 'PNG', margin, margin, targetW, sliceHpt);

          y += sliceHpx;
          page += 1;
        }
      }

      // 3) 하단 문구 크게 (Arial 요청: jsPDF 기본폰트 helvetica 사용)
      const totalPages = doc.getNumberOfPages();
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(16);

      for (let i = 1; i <= totalPages; i++) {
        doc.setPage(i);
        doc.text(FOOTER_TEXT, pageWidth / 2, pageHeight - 14, { align: 'center' });
      }

      const base = `[Linkedin] 견적서_(Korea Partner_HR Point)`;
      doc.save(`${base}_${downloadStamp()}.pdf`);
    }

    async function copyLink(){
      const p = new URLSearchParams({
        qtyRecruiter: $('qtyRecruiter').value || '0',
        aiTier: $('aiTier').value || 'none',
        qtyJob: $('qtyJob').value || '0',
        lifeInclude: $('lifeInclude').value || 'no',
        qtyLTI: $('qtyLTI').value || '0',
        companyName: $('companyName').value || '',
        contactName: $('contactName').value || '',
        contactEmail: $('contactEmail').value || '',
        quoteNo: $('quoteNoInput').value || '',
      });
      const url = `${location.origin}${location.pathname}?${p.toString()}`;

      try{
        await navigator.clipboard.writeText(url);
        toast('입력값 링크가 복사되었습니다.');
      }catch(e){
        const ta = document.createElement('textarea');
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        toast('입력값 링크가 복사되었습니다.');
      }
    }

    function resetAll(){
      sessionStorage.removeItem("lk_quote_no_v1");
      $('companyName').value='';
      $('contactName').value='';
      $('contactEmail').value='';
      $('qtyRecruiter').value='0';
      $('aiTier').value='none';
      $('qtyJob').value='0';
      $('lifeInclude').value='no';
      $('qtyLTI').value='0';
      history.replaceState({}, '', location.pathname);
      ensureQuoteNoOnce();
      recalc();
      toast('초기화 완료');
    }

    document.getElementById('btnPdf')?.addEventListener('click', async (e)=>{e.preventDefault(); await makePdf();});
    document.getElementById('btnCopyLink')?.addEventListener('click', (e)=>{e.preventDefault(); copyLink();});
    document.getElementById('btnReset')?.addEventListener('click', (e)=>{e.preventDefault(); resetAll();});

    ['companyName','contactName','contactEmail','qtyRecruiter','aiTier','qtyJob','lifeInclude','qtyLTI'].forEach(id=>{
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', ()=>recalc());
      el.addEventListener('change', ()=>recalc());
    });

    (function applyStateFromLink(){
      const p = new URLSearchParams(location.search);
      if (p.has('companyName')) document.getElementById('companyName').value = p.get('companyName');
      if (p.has('contactName')) document.getElementById('contactName').value = p.get('contactName');
      if (p.has('contactEmail')) document.getElementById('contactEmail').value = p.get('contactEmail');
      if (p.has('quoteNo')) sessionStorage.setItem("lk_quote_no_v1", p.get('quoteNo'));

      if (p.has('qtyRecruiter')) document.getElementById('qtyRecruiter').value = p.get('qtyRecruiter');
      if (p.has('aiTier')) document.getElementById('aiTier').value = p.get('aiTier');
      if (p.has('qtyJob')) document.getElementById('qtyJob').value = p.get('qtyJob');
      if (p.has('lifeInclude')) document.getElementById('lifeInclude').value = p.get('lifeInclude');
      if (p.has('qtyLTI')) document.getElementById('qtyLTI').value = p.get('qtyLTI');
    })();

    ensureQuoteNoOnce();
    recalc();
  </script>

  <!--
    ✅ 매우 중요: Apps Script(WebApp) 코드가 doGet(e)로 파라미터를 받아 appendRow 해야 저장됩니다.
    예시(Code.gs):

    const SHEET_NAME='Leads';
    function doGet(e){
      const sh = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME) || SpreadsheetApp.getActiveSpreadsheet().insertSheet(SHEET_NAME);
      if(sh.getLastRow()===0) sh.appendRow(['savedAt','quoteNo','companyName','contactName','contactEmail','currency','totalUSD','selectedCount','selectedSummary','aiTier','userAgent','pageUrl']);
      const p=e.parameter||{};
      sh.appendRow([p.savedAt||new Date().toISOString(),p.quoteNo||'',p.companyName||'',p.contactName||'',p.contactEmail||'',p.currency||'USD',p.totalUSD||'',p.selectedCount||'',p.selectedSummary||'',p.aiTier||'',p.userAgent||'',p.pageUrl||'']);
      return ContentService.createTextOutput('ok');
    }

    그리고 웹앱 배포에서 "모든 사용자(Anyone)"로 접근 허용해야 합니다.
  -->
</body>
</html>
